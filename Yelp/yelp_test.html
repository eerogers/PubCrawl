<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>Test Yelp API</title>
	<link rel="stylesheet" href="http://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.min.css">

	<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>

</head>
<body>

<!-- CSS -->

<style>
.results {
	padding-top: 5px;
	overflow-x: scroll;
	white-space: nowrap;
	height: 330px;
}

.items {
	display: inline-block;
}

.image-resize-div {
  position: relative;
  width: 250px;
  height: 125px;
  overflow: hidden;
}
.image-resize-div img {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 100%;
  height: auto;
  -webkit-transform: translate(-50%,-50%);
      -ms-transform: translate(-50%,-50%);
          transform: translate(-50%,-50%);
}


</style>

<!-- HTML -->
	<div class="yelp">
		
		<button id="test">Click Me</button>
	</div>
	<div class="yelp-bar" style="background: #D32323"><img src="Yelp_trademark_RGB.png" alt="yelp-logo" width="100px"/></div>

	<!-- Yelp Header -->

		<hr>
		<div class="row column text-center">
			<div class="yelp-bar" style="background: #D32323">
				<img src="Yelp_trademark_RGB.png" alt="yelp-logo" width="100px"/>
			</div>
		<hr>
		</div>

	<!-- Yelp Data for Event Landing Page -->

		<div class="row small-up-2 medium-up-3 large-up-6 results">

		</div>
		<hr>


<!--JavaScript-->

<script>
	
//predefine results within 10 mile radius based on location chosen for event - returns restaurants, bars, and coffee shops
	var q = "restaurants";
	var loc = $(localStorage.getItem("address"));

$("#test").on("click", function() {
	var queryURL = 	"https://pure-savannah-62932.herokuapp.com/yelp/?q=" + q + "&location=" + loc + "&radius=5mi&open_now=true" 

	$.ajax({
		url: queryURL,
		method: "GET"
	}).done(function(response) {
		var yelpResults = response.jsonBody.businesses;	

		console.log(yelpResults);

		for (var i = 0; i < yelpResults.length; i++) {
			var distanceMiles = Math.round((yelpResults[i].distance * 0.000621371192)*100)/100;

			console.log(yelpResults[i].location);

			var yelpDiv = $("<div class='items'>")

			var yelpData =  "<div class='image-resize-div'><img class='thumbnail image-resize' src='" + yelpResults[i].image_url + "' width='300'></div><h5><b>" + yelpResults[i].name + "</b></h5><p><b>Price:</b> " + yelpResults[i].price + "<br/><b>Rating:</b> " + yelpResults[i].rating + "/5<br/><b>Miles Away:</b> " + distanceMiles + "<br/><b>Phone:</b> " + yelpResults[i].display_phone +"</p><a href='" + yelpResults[i].url + "' class='button small expanded hollow yelp-link'>Take Me There</a>";

			// + yelpResults[i].display_phone + "</td><td>" + yelpResults[i].location.display_address + "</td><td>" + distanceMiles +"</td>";

			yelpDiv.append(yelpData);

			$(".results").append(yelpDiv);
		};
	});
});


</script>
	
</body>
</html>